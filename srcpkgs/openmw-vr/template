# Template file for 'openmw-vr'
pkgname=openmw-vr
version=0.49.2
revision=1
build_style=cmake
_recast_commit=c393777d26d2ff6519ac23612abf8af42678c9dd
_bullet_tag=3.17
_openxr_tag=release-1.0.24
configure_args="-DOPENMW_USE_SYSTEM_BULLET=OFF -DFETCHCONTENT_FULLY_DISCONNECTED=ON -DOPENMW_LTO_BUILD=ON -DBUILD_OPENMW_VR=ON"
hostmakedepends="pkg-config qt6-tools"
makedepends="liblz4-devel yaml-cpp-devel libunshield-devel ffmpeg6-devel
 osg-devel boost-devel libmygui-devel libopenal-devel LuaJIT-devel libXt-devel
 qt6-svg-devel SDL2-devel"
short_desc="Open Implementation of Morrowind's Engine with OpenXR support"
maintainer="Lennart Kroll <void@lennyboy.anonaddy.com>"
license="GPL-3.0-or-later"
homepage="https://gitlab.com/madsbuvi/openmw"
distfiles="https://github.com/madsbuvi/openmw/archive/refs/tags/openmw-vr-${version}.tar.gz
 https://github.com/recastnavigation/recastnavigation/archive/${_recast_commit}.tar.gz
 https://github.com/bulletphysics/bullet3/archive/refs/tags/${_bullet_tag}.tar.gz
 https://github.com/KhronosGroup/OpenXR-SDK/archive/refs/tags/${_openxr_tag}.tar.gz"
checksum="afc3be50491a0ca994e01f5a12b568056769719218d8cb942e7ecd847ff38d1f
 fa8b901651017b20a38996bbab2d205d244328ed11778b53224282e9884e6c91
 baa642c906576d4d98d041d0acb80d85dd6eff6e3c16a009b1abf1ccd2bc0a61
 9b372b75c530cd89f48f7d5b43846e69670670be50cd9a16ed7731792cf063ad"
conflicts="openmw"

skip_extraction="${_recast_commit}.tar.gz ${_bullet_tag}.tar.gz ${_openxr_tag}.tar.gz"

post_extract() {
	mkdir -p build/fetched/recastnavigation \
		build/fetched/bullet \
		build/_deps/openxr-src \
		build/extern
	ln -s -r build/fetched extern/fetched
	ln -s -r build/fetched build/extern/fetched
	ln -s -r build/fetched components/fetched
	ln -s -r build/fetched fetched

	vsrcextract -C build/fetched/recastnavigation "${_recast_commit}.tar.gz"
	vsrcextract -C build/fetched/bullet "${_bullet_tag}.tar.gz"
	vsrcextract -C build/_deps/openxr-src "${_openxr_tag}.tar.gz"
}

post_install() {
	vbin build/openmw_vr
	rm -rf ${DESTDIR}/usr/include
	rm -rf ${DESTDIR}/usr/lib
	rm -rf ${DESTDIR}/usr/share/doc
}
